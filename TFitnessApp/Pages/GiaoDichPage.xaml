<Page x:Class="TFitnessApp.GiaoDichPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
      xmlns:local="clr-namespace:TFitnessApp"
      xmlns:fa="clr-namespace:FontAwesome.Sharp;assembly=FontAwesome.Sharp" 
      mc:Ignorable="d" 
      d:DesignHeight="650" d:DesignWidth="1000"
      Title="GiaoDichPage"
      Background="White">

    <!-- KHỐI ĐỊNH NGHĨA TÀI NGUYÊN (RESOURCES) -->
    <Page.Resources>
        <!-- Style chung cho các nút tròn (RoundButtonStyle) -->
        <Style x:Key="RoundButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="#C71A1B"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="Padding" Value="15,5"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}" CornerRadius="5">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <!-- Trigger hiệu ứng khi di chuột qua -->
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#A51617"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <!-- Style cho Header của DataGrid (CenteredHeaderStyle) -->
        <Style x:Key="CenteredHeaderStyle" TargetType="{x:Type DataGridColumnHeader}">
            <Setter Property="HorizontalContentAlignment" Value="Center" />
            <Setter Property="VerticalContentAlignment" Value="Center" />
            <Setter Property="Padding" Value="10,10,10,10"/>
            <Setter Property="Background" Value="#E1E0E7"/>
            <Setter Property="BorderBrush" Value="#E1E0E7"/>
            <Setter Property="BorderThickness" Value="1,1,1,0"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Foreground" Value="#333"/>
        </Style>

        <!-- Style tùy chỉnh cho các dòng của DataGrid (CustomRowStyle) -->
        <Style x:Key="CustomRowStyle" TargetType="{x:Type DataGridRow}">
            <Setter Property="Background" Value="White"/>
            <Style.Triggers>
                <Trigger Property="IsSelected" Value="True">
                    <Setter Property="Background" Value="#FFDDDD"/>
                    <Setter Property="Foreground" Value="Black"/>
                    <Setter Property="BorderBrush" Value="#C71A1B"/>
                    <Setter Property="BorderThickness" Value="1"/>
                </Trigger>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#F5F5F5"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <!-- Style cho các nút RadioButton (PaymentTabStyle) để chuyển Tab trạng thái thanh toán -->
        <Style x:Key="PaymentTabStyle" TargetType="RadioButton">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="10,15,10,10"/>
            <Setter Property="GroupName" Value="PaymentStatus"/>
            <Setter Property="HorizontalAlignment" Value="Stretch"/>
            <Setter Property="HorizontalContentAlignment" Value="Center"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
            <Setter Property="Foreground" Value="#666"/>
            <Setter Property="FontSize" Value="16"/>
            <Setter Property="FontWeight" Value="Normal"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="RadioButton">
                        <Grid Background="{TemplateBinding Background}">
                            <ContentPresenter HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}"
                                              VerticalAlignment="{TemplateBinding VerticalContentAlignment}"
                                              Content="{TemplateBinding Content}"
                                              Margin="{TemplateBinding Padding}"
                                              TextElement.Foreground="{TemplateBinding Foreground}"/>
                            <Border x:Name="Underline" Height="3" VerticalAlignment="Bottom" Background="Transparent" Margin="0,0,-1,0"/>
                        </Grid>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsChecked" Value="True">
                                <Setter TargetName="Underline" Property="Background" Value="#C71A1B"/>
                                <Setter Property="Foreground" Value="#C71A1B"/>
                                <Setter Property="FontWeight" Value="SemiBold"/>
                            </Trigger>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Foreground" Value="#C71A1B"/>
                                <Setter Property="Cursor" Value="Hand"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Style cho nội dung TextBlock căn giữa trong DataGrid (CenteredContentStyle) -->
        <Style x:Key="CenteredContentStyle" TargetType="{x:Type TextBlock}">
            <Setter Property="HorizontalAlignment" Value="Center" />
            <Setter Property="VerticalAlignment" Value="Center" />
            <Setter Property="TextAlignment" Value="Center"/>
            <Setter Property="Padding" Value="5,2"/>
        </Style>

        <!-- Style tùy chỉnh cho DataGrid (CustomDataGridStyle) -->
        <Style x:Key="CustomDataGridStyle" TargetType="{x:Type DataGrid}">
            <Setter Property="Background" Value="White"/>
            <Setter Property="BorderBrush" Value="#E1E0E7"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="RowDetailsVisibilityMode" Value="VisibleWhenSelected"/>
            <Setter Property="ScrollViewer.CanContentScroll" Value="True"/>
            <Setter Property="ScrollViewer.PanningMode" Value="Both"/>
            <Setter Property="Stylus.IsFlicksEnabled" Value="False"/>
            <Setter Property="AutoGenerateColumns" Value="False"/>
            <Setter Property="CanUserAddRows" Value="False"/>
            <Setter Property="CanUserDeleteRows" Value="False"/>
            <Setter Property="CanUserReorderColumns" Value="False"/>
            <Setter Property="CanUserResizeColumns" Value="True"/>
            <Setter Property="CanUserResizeRows" Value="False"/>
            <Setter Property="CanUserSortColumns" Value="True"/>
            <Setter Property="GridLinesVisibility" Value="Horizontal"/>
            <Setter Property="HorizontalGridLinesBrush" Value="#EEEEEE"/>
            <Setter Property="VerticalGridLinesBrush" Value="Transparent"/>
            <Setter Property="SelectionMode" Value="Extended"/>
            <Setter Property="SelectionUnit" Value="FullRow"/>
        </Style>

        <!-- Style cho các nút phân trang (PaginationButtonStyle) -->
        <Style x:Key="PaginationButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="White"/>
            <Setter Property="BorderBrush" Value="#CCCCCC"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="8,4"/>
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="MinWidth" Value="30"/>
            <Setter Property="Height" Value="30"/>
            <Style.Triggers>
                <Trigger Property="IsEnabled" Value="False">
                    <Setter Property="Background" Value="#F0F0F0"/>
                    <Setter Property="Foreground" Value="#999999"/>
                    <Setter Property="Cursor" Value="Arrow"/>
                </Trigger>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#E0E0E0"/>
                    <Setter Property="Cursor" Value="Hand"/>
                </Trigger>
            </Style.Triggers>
        </Style>

    </Page.Resources>

    <!-- KHỐI CHÍNH (MAIN GRID) -->
    <Grid Margin="20" Background="White">
        <!-- Định nghĩa 5 dòng: Tiêu đề/Tìm kiếm, Tab trạng thái, DataGrid, Phân trang, Nút hành động -->
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- DÒNG 0: TIÊU ĐỀ, TÌM KIẾM, NÚT TẠO/LÀM MỚI -->
        <Grid Grid.Row="0" Margin="0,0,0,20">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <!-- Khối Tiêu đề (Danh sách Giao dịch) -->
            <Border Grid.Column="0" CornerRadius="0,20,20,0" Margin="0,0,15,0" Background="#C71A1B">
                <Border.Effect>
                    <DropShadowEffect ShadowDepth="2" Direction="270" Color="#000000" Opacity="0.2" BlurRadius="5"/>
                </Border.Effect>
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="5"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    <Border Grid.Column="0" Background="#4B1718" Margin="-5,0,0,0"/>
                    <TextBlock Grid.Column="1" Text="Danh sách Giao dịch" 
                               Padding="20,12" 
                               FontWeight="SemiBold" 
                               Foreground="White"
                               VerticalAlignment="Center"
                               HorizontalAlignment="Center"
                               FontSize="14"/>
                </Grid>
            </Border>

            <!-- Khối Tìm kiếm (Search Bar) -->
            <Border Grid.Column="1" CornerRadius="8" Background="#ECECEC" Height="40" VerticalAlignment="Center" Margin="0,0,15,0"
                    BorderBrush="#CCCCCC" BorderThickness="1">
                <Border.Effect>
                    <DropShadowEffect ShadowDepth="2" Direction="270" Color="#000000" Opacity="0.2" BlurRadius="5"/>
                </Border.Effect>
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <Grid Grid.Column="0" Margin="15,0,0,0">
                        <!-- TextBox nhập liệu tìm kiếm -->
                        <TextBox x:Name="SearchTextBox" 
                                 BorderThickness="0" 
                                 Background="Transparent" 
                                 VerticalContentAlignment="Center" 
                                 Foreground="#333" 
                                 Padding="0"
                                 FontSize="13"
                                 GotFocus="SearchTextBox_GotFocus"
                                 LostFocus="SearchTextBox_LostFocus"
                                 KeyDown="SearchTextBox_KeyDown"
                                 TextChanged="SearchTextBox_TextChanged"
                                 Panel.ZIndex="2"/>
                        <!-- TextBlock Placeholder (Hướng dẫn) -->
                        <TextBlock x:Name="SearchPlaceholder"
                                   IsHitTestVisible="False" 
                                   VerticalAlignment="Center" 
                                   Foreground="#999"
                                   FontStyle="Italic"
                                   FontSize="13"
                                   Panel.ZIndex="1"/>
                    </Grid>

                    <!-- Nút tìm kiếm (Icon Search) -->
                    <Button Grid.Column="1" Background="Transparent" BorderThickness="0" Padding="0" Width="40" Height="40"
                            ToolTip="Tìm kiếm" Click="ThucHienTimKiem_Click">
                        <Viewbox Width="16" Height="16" Margin="0,0,15,0">
                            <fa:IconImage Icon="Search" Foreground="#666" />
                        </Viewbox>
                    </Button>
                </Grid>
            </Border>

            <!-- Nút Tạo giao dịch mới -->
            <Border Grid.Column="2" CornerRadius="5" Margin="0,0,10,0">
                <Border.Effect>
                    <DropShadowEffect ShadowDepth="2" Direction="270" Color="#000000" Opacity="0.2" BlurRadius="5"/>
                </Border.Effect>
                <Button x:Name="btnAddTransaction"
                        Padding="15,8" 
                        FontWeight="SemiBold" 
                        Height="40" 
                        VerticalAlignment="Center"
                        ToolTip="Tạo giao dịch mới"
                        Style="{StaticResource RoundButtonStyle}"
                        Click="AddTransactionCommand_Click">
                    <StackPanel Orientation="Horizontal">
                        <fa:IconImage Icon="CirclePlus" Width="15" Height="16" Margin="10,0,1,0" VerticalAlignment="Center" Foreground="White"/>
                        <TextBlock Text="Tạo" VerticalAlignment="Center" Margin="1,0,10,0" FontSize="13"/>
                    </StackPanel>
                </Button>
            </Border>

            <!-- Nút Làm mới dữ liệu -->
            <Border Grid.Column="3" CornerRadius="5">
                <Border.Effect>
                    <DropShadowEffect ShadowDepth="2" Direction="270" Color="#000000" Opacity="0.2" BlurRadius="5"/>
                </Border.Effect>
                <Button x:Name="btnRefresh"
                        Padding="15,8" 
                        FontWeight="SemiBold"
                        Height="40"
                        VerticalAlignment="Center"
                        ToolTip="Làm mới dữ liệu"
                        Style="{StaticResource RoundButtonStyle}"
                        Click="RefreshCommand_Click">
                    <StackPanel Orientation="Horizontal">
                        <fa:IconImage Icon="ArrowsRotate" Width="16" Height="16" Margin="6,0,1,0" VerticalAlignment="Center" Foreground="White"/>
                        <TextBlock Text="Làm mới" Margin="1,0,6,0" VerticalAlignment="Center" FontSize="13"/>
                    </StackPanel>
                </Button>
            </Border>
        </Grid>

        <!-- DÒNG 1: KHỐI CHỌN TRẠNG THÁI THANH TOÁN (TAB) -->
        <Border Grid.Row="1" 
                CornerRadius="8" 
                Background="White" 
                BorderBrush="#E1E0E7" 
                BorderThickness="1"
                Margin="0,0,0,15"
                Padding="0">
            <Border.Effect>
                <DropShadowEffect ShadowDepth="1" Direction="270" Color="#000000" Opacity="0.1" BlurRadius="3"/>
            </Border.Effect>
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                <!-- Tab: Chưa thanh toán -->
                <RadioButton x:Name="rbChuaThanhToan"
                             Grid.Column="0" 
                             Content="Chưa thanh toán" 
                             Style="{StaticResource PaymentTabStyle}"
                             IsChecked="True" 
                             Checked="RadioButton_Checked"/>
                <!-- Tab: Thanh toán một phần -->
                <RadioButton x:Name="rbThanhToanMotPhan"
                             Grid.Column="1" 
                             Content="Thanh toán một phần" 
                             Style="{StaticResource PaymentTabStyle}"
                             Checked="RadioButton_Checked"/>
                <!-- Tab: Đã thanh toán -->
                <RadioButton x:Name="rbDaThanhToan"
                             Grid.Column="2" 
                             Content="Đã thanh toán" 
                             Style="{StaticResource PaymentTabStyle}"
                             Checked="RadioButton_Checked"/>
            </Grid>
        </Border>

        <!-- DÒNG 2: DATA GRID HIỂN THỊ DANH SÁCH GIAO DỊCH -->
        <Border Grid.Row="2" 
                CornerRadius="10" 
                BorderBrush="#E1E0E7" 
                BorderThickness="2" 
                Background="White"
                ClipToBounds="True"
                Margin="0,0,0,15">
            <Border.Effect>
                <DropShadowEffect ShadowDepth="3" Direction="270" Color="#000000" Opacity="0.1" BlurRadius="10"/>
            </Border.Effect>

            <DataGrid x:Name="dgGiaoDich"
                      Style="{StaticResource CustomDataGridStyle}"
                      AutoGenerateColumns="False" 
                      IsReadOnly="True"
                      RowHeaderWidth="0"
                      HeadersVisibility="Column"
                      RowStyle="{StaticResource CustomRowStyle}"
                      ColumnHeaderStyle="{StaticResource CenteredHeaderStyle}">

                <DataGrid.Columns>
                    <!-- Cột Chọn và Xem chi tiết -->
                    <DataGridTemplateColumn Width="70" Header="Chọn">
                        <DataGridTemplateColumn.HeaderTemplate>
                            <DataTemplate>
                                <CheckBox x:Name="chkSelectAll" 
                                          Checked="SelectAllCheckBox_Checked" 
                                          Unchecked="SelectAllCheckBox_Checked"
                                          ToolTip="Chọn tất cả"/>
                            </DataTemplate>
                        </DataGridTemplateColumn.HeaderTemplate>
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" VerticalAlignment="Center">
                                    <CheckBox IsChecked="{Binding IsSelected, Mode=TwoWay}" 
                                              VerticalAlignment="Center" 
                                              Margin="0,0,8,0"
                                              Checked="CheckBox_Checked"
                                              Unchecked="CheckBox_Unchecked"
                                              ToolTip="Chọn giao dịch này"/>
                                    <!-- Nút Xem chi tiết -->
                                    <Button Background="Transparent" 
                                            BorderThickness="0" 
                                            Padding="4" 
                                            Click="ViewTransactionCommand_Click"
                                            ToolTip="Xem chi tiết giao dịch">
                                        <Viewbox Width="14" Height="14">
                                            <fa:IconImage Icon="Eye" Foreground="#666" VerticalAlignment="Center"/>
                                        </Viewbox>
                                    </Button>
                                </StackPanel>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>

                    <!-- Cột Mã GD (Giao dịch) -->
                    <DataGridTextColumn Header="Mã GD" 
                                        Binding="{Binding MaGD}" 
                                        Width="95" 
                                        ElementStyle="{StaticResource CenteredContentStyle}"/>

                    <!-- Cột Mã HV (Học viên) -->
                    <DataGridTextColumn Header="Mã HV" 
                                        Binding="{Binding MaHV}" 
                                        Width="95" 
                                        ElementStyle="{StaticResource CenteredContentStyle}"/>

                    <!-- Cột Mã Gói -->
                    <DataGridTextColumn Header="Mã Gói" 
                                        Binding="{Binding MaGoi}" 
                                        Width="95" 
                                        ElementStyle="{StaticResource CenteredContentStyle}"/>

                    <!-- Cột Mã TK (Tài khoản) -->
                    <DataGridTextColumn Header="Mã TK" 
                                        Binding="{Binding MaTK}" 
                                        Width="95" 
                                        ElementStyle="{StaticResource CenteredContentStyle}"/>

                    <!-- Cột Tổng Tiền (Đã format tiền tệ) -->
                    <DataGridTextColumn Header="Tổng Tiền" 
                                        Binding="{Binding TongTienFormatted}" 
                                        Width="150" 
                                        ElementStyle="{StaticResource CenteredContentStyle}"/>

                    <!-- Cột Đã Thanh Toán (Đã format tiền tệ) -->
                    <DataGridTextColumn Header="Đã Thanh Toán" 
                                        Binding="{Binding DaThanhToanFormatted}" 
                                        Width="150" 
                                        ElementStyle="{StaticResource CenteredContentStyle}"/>

                    <!-- Cột Số Tiền Nợ (Đã format tiền tệ) -->
                    <DataGridTextColumn Header="Số Tiền Nợ" 
                                        Binding="{Binding SoTienNoFormatted}" 
                                        Width="150" 
                                        ElementStyle="{StaticResource CenteredContentStyle}"/>

                    <!-- Cột Ngày GD (Đã format ngày) -->
                    <DataGridTextColumn Header="Ngày GD" 
                                        Binding="{Binding NgayGDFormatted}" 
                                        Width="130" 
                                        ElementStyle="{StaticResource CenteredContentStyle}"/>

                    <!-- Cột Trạng Thái (Với style màu sắc theo DataTrigger) -->
                    <DataGridTemplateColumn Header="Trạng Thái" Width="*">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <Border CornerRadius="12" 
                                        Padding="8,4" 
                                        HorizontalAlignment="Center" 
                                        VerticalAlignment="Center"
                                        BorderThickness="1">
                                    <TextBlock Text="{Binding TrangThai}" 
                                               FontWeight="SemiBold" 
                                               FontSize="11"
                                               HorizontalAlignment="Center"
                                               VerticalAlignment="Center">
                                        <TextBlock.Style>
                                            <Style TargetType="TextBlock">
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding TrangThai}" Value="Trả Một Phần">
                                                        <Setter Property="Foreground" Value="#D97706"/>
                                                    </DataTrigger>
                                                    <DataTrigger Binding="{Binding TrangThai}" Value="Chưa Thanh Toán">
                                                        <Setter Property="Foreground" Value="#DC2626"/>
                                                    </DataTrigger>
                                                    <DataTrigger Binding="{Binding TrangThai}" Value="Đã Thanh Toán">
                                                        <Setter Property="Foreground" Value="#059669"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </TextBlock.Style>
                                    </TextBlock>
                                    <Border.Style>
                                        <Style TargetType="Border">
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding TrangThai}" Value="Trả Một Phần">
                                                    <Setter Property="Background" Value="#FEF3C7"/>
                                                    <Setter Property="BorderBrush" Value="#F59E0B"/>
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding TrangThai}" Value="Chưa Thanh Toán">
                                                    <Setter Property="Background" Value="#FEE2E2"/>
                                                    <Setter Property="BorderBrush" Value="#EF4444"/>
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding TrangThai}" Value="Đã Thanh Toán">
                                                    <Setter Property="Background" Value="#D1FAE5"/>
                                                    <Setter Property="BorderBrush" Value="#10B981"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Border.Style>
                                </Border>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                </DataGrid.Columns>

                <!-- Context Menu khi chuột phải vào DataGrid -->
                <DataGrid.ContextMenu>
                    <ContextMenu>
                        <MenuItem Header="Làm mới" Click="MenuItem_Refresh_Click"/>
                        <Separator/>
                        <MenuItem Header="Tạo giao dịch mới" Click="MenuItem_AddTransaction_Click"/>
                    </ContextMenu>
                </DataGrid.ContextMenu>
            </DataGrid>
        </Border>

        <!-- DÒNG 3: THANH PHÂN TRANG (PAGINATION) -->
        <Border Grid.Row="3" 
                Background="#F5F5F5" 
                BorderBrush="#E0E0E0" 
                BorderThickness="0,1,0,0" 
                Padding="10"
                Margin="0,0,0,10">
            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" VerticalAlignment="Center">
                <!-- ComboBox chọn số bản ghi mỗi trang -->
                <TextBlock Text="Hiển thị:" VerticalAlignment="Center" Margin="0,0,5,0" FontSize="12"/>
                <ComboBox x:Name="cboSoBanGhiMoiTrang" 
                          Width="60" 
                          VerticalAlignment="Center"
                          SelectionChanged="cboSoBanGhiMoiTrang_SelectionChanged"
                          FontSize="12"/>

                <!-- TextBlock hiển thị thông tin phân trang -->
                <TextBlock x:Name="txtThongTinPhanTrang" 
                           VerticalAlignment="Center" 
                           Margin="20,0,0,0"
                           FontSize="12"/>

                <!-- Khối các nút chuyển trang -->
                <StackPanel Orientation="Horizontal" Margin="20,0,0,0">
                    <Button x:Name="btnTrangDau" 
                            Content="&lt;&lt;" 
                            Style="{StaticResource PaginationButtonStyle}"
                            Click="btnTrangDau_Click" 
                            ToolTip="Trang đầu"/>
                    <Button x:Name="btnTrangTruoc" 
                            Content="&lt;" 
                            Style="{StaticResource PaginationButtonStyle}"
                            Click="btnTrangTruoc_Click" 
                            ToolTip="Trang trước" 
                            Margin="5,0,0,0"/>

                    <!-- TextBox chuyển nhanh đến trang cụ thể -->
                    <TextBox x:Name="txtChuyenTrang" 
                            Width="40" 
                            TextAlignment="Center" 
                            VerticalContentAlignment="Center"
                            Margin="10,0,5,0" 
                            ToolTip="Nhập số trang và Enter" 
                            KeyDown="txtChuyenTrang_KeyDown"
                            FontSize="12"/>
                    <!-- TextBlock hiển thị trang hiện tại / tổng số trang -->
                    <TextBlock x:Name="txtTrangHienTai" 
                               VerticalAlignment="Center" 
                               Margin="0,0,10,0"
                               FontSize="12"/>

                    <Button x:Name="btnTrangSau" 
                            Content="&gt;" 
                            Style="{StaticResource PaginationButtonStyle}"
                            Click="btnTrangSau_Click" 
                            ToolTip="Trang sau"/>
                    <Button x:Name="btnTrangCuoi" 
                            Content="&gt;&gt;" 
                            Style="{StaticResource PaginationButtonStyle}"
                            Click="btnTrangCuoi_Click" 
                            ToolTip="Trang cuối" 
                            Margin="5,0,0,0"/>
                </StackPanel>
            </StackPanel>
        </Border>

        <!-- DÒNG 4: THÔNG TIN TỔNG QUAN VÀ CÁC NÚT HÀNH ĐỘNG (XÓA/XUẤT FILE) -->
        <Grid Grid.Row="4">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <!-- StackPanel hiển thị thông tin số lượng giao dịch -->
            <StackPanel x:Name="InfoStackPanel" Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center">
                <TextBlock x:Name="txtSoGiaoDichHienThi"
                           Foreground="#666" 
                           FontSize="12"
                           Margin="5,0,0,0"/>
                <TextBlock x:Name="txtSoGiaoDichDaChon"
                           Foreground="#C71A1B" 
                           FontSize="12"
                           FontWeight="SemiBold"
                           Margin="15,0,0,0"
                           Visibility="Collapsed"/>
            </StackPanel>

            <!-- StackPanel chứa các nút hành động (Xóa, Xuất) -->
            <StackPanel Grid.Column="1" Orientation="Horizontal" HorizontalAlignment="Right">
                <!-- Nút Xóa giao dịch đã chọn -->
                <Button x:Name="btnDelete"
                        Style="{StaticResource RoundButtonStyle}" 
                        Height="36" 
                        Width="90"
                        Margin="0,0,10,0"
                        ToolTip="Xóa giao dịch đã chọn"
                        Click="DeleteTransactionCommand_Click">
                    <StackPanel Orientation="Horizontal">
                        <Viewbox Width="14" Height="14" Margin="0,0,4,0" VerticalAlignment="Center">
                            <fa:IconImage Icon="Trash" Foreground="White"/>
                        </Viewbox>
                        <TextBlock Text="Xóa" VerticalAlignment="Center" FontSize="12" />
                    </StackPanel>
                </Button>

                <!-- Nút Xuất danh sách giao dịch -->
                <Button x:Name="btnExport"
                        Style="{StaticResource RoundButtonStyle}" 
                        Width="90" 
                        Height="36"
                        ToolTip="Xuất danh sách giao dịch"
                        Click="ExportTransactionCommand_Click">
                    <StackPanel Orientation="Horizontal">
                        <Viewbox Width="14" Height="14" Margin="0,0,4,0" VerticalAlignment="Center">
                            <fa:IconImage Icon="Upload" Foreground="White"/>
                        </Viewbox>
                        <TextBlock Text="Xuất" VerticalAlignment="Center" FontSize="12" />
                    </StackPanel>
                </Button>
            </StackPanel>
        </Grid>

        <!-- KHỐI CHẶN (LOADING INDICATOR) - Hiển thị khi đang tải dữ liệu -->
        <Border Grid.Row="0" Grid.RowSpan="5" 
                Background="#80000000" 
                x:Name="LoadingIndicator"
                Visibility="Collapsed"
                Panel.ZIndex="1000">
            <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                <Border Background="White" CornerRadius="8" Padding="20" Width="200" Height="100">
                    <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                        <!-- Icon quay loading -->
                        <fa:IconImage Icon="Refresh" Width="24" Height="24" Foreground="#C71A1B" 
                                      HorizontalAlignment="Center" Margin="0,0,0,10">
                            <fa:IconImage.RenderTransform>
                                <RotateTransform CenterX="12" CenterY="12"/>
                            </fa:IconImage.RenderTransform>
                            <fa:IconImage.Triggers>
                                <EventTrigger RoutedEvent="Loaded">
                                    <BeginStoryboard>
                                        <Storyboard>
                                            <DoubleAnimation Storyboard.TargetProperty="RenderTransform.Angle"
                                                             From="0" To="360" Duration="0:0:1" 
                                                             RepeatBehavior="Forever"/>
                                        </Storyboard>
                                    </BeginStoryboard>
                                </EventTrigger>
                            </fa:IconImage.Triggers>
                        </fa:IconImage>
                        <TextBlock Text="Đang tải dữ liệu..." HorizontalAlignment="Center" Foreground="#333" FontWeight="SemiBold"/>
                    </StackPanel>
                </Border>
            </StackPanel>
        </Border>
    </Grid>
</Page>